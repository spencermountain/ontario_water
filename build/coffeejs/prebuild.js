// Generated by CoffeeScript 1.8.0
var add_meta, analysis, be_even, crop_video, master, path, reconcile_paths, run_sync, shell, strip_audio;

shell = require("shelljs");

path = require("path");

run_sync = require("./cmd");

analysis = require("./analysis");

reconcile_paths = function(file, flag, ext) {
  var obj, old_ext;
  if (file == null) {
    file = "";
  }
  if (flag == null) {
    flag = "";
  }
  if (ext == null) {
    ext = "mp4";
  }
  obj = {};
  if (flag) {
    flag = "_" + flag;
  }
  obj.input = path.join(__dirname, file);
  obj.name = path.basename(obj.input);
  old_ext = path.extname(obj.name);
  obj.output = path.join(__dirname, "/assets/video_master", "" + (path.basename(obj.input, old_ext)) + flag + "." + ext);
  return obj;
};

be_even = function(h) {
  return Math.floor(h / 2) * 2;
};

master = function(input) {
  var obj, old_ext;
  obj = reconcile_paths(input, "", "mp4");
  old_ext = path.extname(obj.name);
  console.log("converting " + obj.name + " to mp4");
  run_sync("ffmpeg -i " + obj.input + " -y " + obj.output);
  analysis.diff(obj.input, obj.output);
  return obj.output;
};

crop_video = function(file, h) {
  var obj;
  h = be_even(h);
  obj = reconcile_paths(file, "CROP" + h);
  console.log("resizing " + obj.name + " height to " + h + "px");
  run_sync("ffmpeg -i " + obj.input + " -y -filter:v 'crop=in_w:" + h + "' " + obj.output);
  analysis.diff(obj.input, obj.output);
  return obj.output;
};

strip_audio = function(input) {
  var name, output;
  input = path.join(__dirname, input);
  name = path.basename(input);
  output = path.join(__dirname, "QUIET_" + name);
  console.log("stripping audio from " + name + "..");
  run_sync("ffmpeg -i " + input + " -y -vcodec copy -an " + output);
  analysis.diff(input, output);
  return output;
};

add_meta = function(file) {
  var input, output;
  input = path.join(__dirname, file);
  output = path.join(__dirname, "META_" + file);
  run_sync("ffmpeg -i " + input + " -y -metadata author='Spencer Kelly' -metadata comment='@spencermountain' -metadata year='2014' " + output);
  analysis.pretty_print(output);
  return output;
};

module.exports = {
  strip_audio: strip_audio,
  master: master,
  add_meta: add_meta
};

analysis.play(master("./shakey_spring.MOV"));

//# sourceMappingURL=prebuild.js.map
